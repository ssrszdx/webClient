{"version":3,"file":"868.prod.js","mappings":"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","sources":["webpack://tinode-webapp/./src/views/create-account-view.jsx","webpack://tinode-webapp/./src/widgets/phone-edit.jsx"],"sourcesContent":["// Account registration.\r\nimport React, { Suspense } from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport AvatarCrop from '../widgets/avatar-crop.jsx';\r\nimport AvatarUpload from '../widgets/avatar-upload.jsx';\r\nimport CheckBox from '../widgets/checkbox.jsx';\r\nimport PhoneEdit from '../widgets/phone-edit.jsx';\r\nimport VisiblePassword from '../widgets/visible-password.jsx';\r\n\r\nimport LocalStorageUtil from '../lib/local-storage.js';\r\nimport { imageScaled, blobToBase64, makeImageUrl } from '../lib/blob-helpers.js';\r\nimport { theCard } from '../lib/utils.js';\r\n\r\nimport { AVATAR_SIZE, MAX_AVATAR_BYTES, MAX_EXTERN_ATTACHMENT_SIZE,\r\n  MAX_TITLE_LENGTH } from '../config.js';\r\n\r\nexport default class CreateAccountView extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      login: '',\r\n      password: '',\r\n      meth: '',\r\n      email: '',\r\n      tel: '',\r\n      fn: '', // full/formatted name\r\n      imageUrl: null,\r\n      uploadUrl: null,\r\n      newAvatar: null,\r\n      newAvatarMime: null,\r\n      buttonDisabled: false,\r\n      saveToken: LocalStorageUtil.getObject('keep-logged-in')\r\n    };\r\n\r\n    this.handleLoginChange = this.handleLoginChange.bind(this);\r\n    this.handlePasswordChange = this.handlePasswordChange.bind(this);\r\n    this.handleEmailChange = this.handleEmailChange.bind(this);\r\n    this.handlePhoneChange = this.handlePhoneChange.bind(this);\r\n    this.handleFnChange = this.handleFnChange.bind(this);\r\n    this.handleImageChanged = this.handleImageChanged.bind(this);\r\n    this.handleToggleSaveToken = this.handleToggleSaveToken.bind(this);\r\n    this.handleAvatarCropped = this.handleAvatarCropped.bind(this);\r\n    this.handleAvatarCropCancel = this.handleAvatarCropCancel.bind(this);\r\n    this.uploadAvatar = this.uploadAvatar.bind(this);\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n\r\n    // Connection will trigger change by changing the this.props.serverVersion.\r\n    props.tinode.connect()\r\n      .catch(err => {\r\n        this.props.onError(err.message, 'err');\r\n      });\r\n  }\r\n\r\n  handleLoginChange(e) {\r\n    this.setState({login: e.target.value});\r\n  }\r\n\r\n  handlePasswordChange(password) {\r\n    this.setState({password: password});\r\n  }\r\n\r\n  handleEmailChange(e) {\r\n    this.setState({meth: 'email', email: e.target.value});\r\n  }\r\n\r\n  handlePhoneChange(number) {\r\n    this.setState({meth: 'tel', tel: number});\r\n  }\r\n\r\n  handleFnChange(e) {\r\n    this.setState({fn: e.target.value});\r\n  }\r\n\r\n  handleImageChanged(mime, img) {\r\n    this.setState({newAvatar: img, newAvatarMime: mime});\r\n  }\r\n\r\n  handleToggleSaveToken() {\r\n    LocalStorageUtil.setObject('keep-logged-in', !this.state.saveToken);\r\n    this.setState({saveToken: !this.state.saveToken});\r\n  }\r\n\r\n  handleSubmit(e) {\r\n    e.preventDefault();\r\n    this.props.onCreateAccount(\r\n      this.state.login.trim(),\r\n      this.state.password.trim(),\r\n      theCard(this.state.fn.trim().substring(0, MAX_TITLE_LENGTH), this.state.uploadUrl),\r\n      {\r\n        'meth': this.state.meth,\r\n        'val': this.state.meth == 'email' ?\r\n          this.state.email :\r\n            this.state.meth == 'tel' ? this.state.tel : null\r\n      }\r\n    );\r\n  }\r\n\r\n  // AvatarCropView calls this method when the user has cropped the image.\r\n  handleAvatarCropped(mime, blob, width, height) {\r\n    const url = blob ? URL.createObjectURL(blob) : null;\r\n    this.setState({avatar: url, newAvatar: null, newAvatarMime: null});\r\n    if (blob) {\r\n      this.uploadAvatar(mime, blob, width, height);\r\n    }\r\n  }\r\n\r\n  handleAvatarCropCancel() {\r\n    this.setState({newAvatar: null, newAvatarMime: null});\r\n  }\r\n\r\n    // Utility method for converting cropped avatar blob to bytes for sending inband or\r\n  // for uploading it to the server out of band.\r\n  uploadAvatar(mime, blob, width, height) {\r\n    const readyToUpload = image => {\r\n      let {mime, blob} = image;\r\n      this.setState({imageUrl: URL.createObjectURL(blob), buttonDisabled: true});\r\n      if (blob.size > MAX_AVATAR_BYTES) {\r\n        // Too large to send inband - uploading out of band and sending as a link.\r\n        const uploader = this.props.tinode.getLargeFileHelper();\r\n        uploader.upload(blob, 'newacc')\r\n          .then(url => this.setState({uploadUrl: url}))\r\n          .catch(err => this.props.onError(err.message, 'err'))\r\n          .finally(_ => this.setState({buttonDisabled: false}));\r\n      } else {\r\n        // Convert blob to base64-encoded bits.\r\n        blobToBase64(blob)\r\n          .then(b64 => this.setState({uploadUrl: makeImageUrl({data: b64.bits, type: mime})}))\r\n          .finally(_ => this.setState({buttonDisabled: false}));\r\n      }\r\n    };\r\n\r\n    if (width > AVATAR_SIZE || height > AVATAR_SIZE || width != height) {\r\n      // Avatar is not square or too large even after cropping. Shrink it and make square.\r\n      imageScaled(blob, AVATAR_SIZE, AVATAR_SIZE, MAX_EXTERN_ATTACHMENT_SIZE, true)\r\n        .then(scaled => readyToUpload(scaled))\r\n        .catch(err => this.props.onError(err.message, 'err'));\r\n    } else {\r\n      readyToUpload({mime: mime, blob: blob, width: width, height: height});\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (this.state.newAvatar) {\r\n      return (\r\n        <AvatarCrop\r\n          avatar={this.state.newAvatar}\r\n          mime={this.state.newAvatarMime}\r\n          onSubmit={this.handleAvatarCropped}\r\n          onCancel={this.handleAvatarCropCancel}\r\n          onError={this.props.onError} />\r\n      );\r\n    }\r\n\r\n    let submitClasses = 'primary';\r\n    if (this.props.disabled) {\r\n      submitClasses += ' disabled';\r\n    }\r\n\r\n    return (\r\n      <form className=\"panel-form-column\" onSubmit={this.handleSubmit}>\r\n        <div className=\"panel-form-row\">\r\n          <div className=\"umn\">\r\n            <FormattedMessage id=\"login_prompt\" defaultMessage=\"Login\"\r\n              description=\"Placeholer for username/login\">{\r\n              (login_prompt) => <input type=\"text\" placeholder={login_prompt} autoComplete=\"user-name\"\r\n                value={this.state.login} onChange={this.handleLoginChange} required autoFocus />\r\n            }</FormattedMessage>\r\n            <FormattedMessage id=\"password_prompt\" defaultMessage=\"Password\"\r\n              description=\"Placeholder/prompt for entering password\">{\r\n              (password_prompt) => <VisiblePassword placeholder={password_prompt} autoComplete=\"new-password\"\r\n                value={this.state.password} onFinished={this.handlePasswordChange}\r\n                required={true} />\r\n            }</FormattedMessage>\r\n          </div>\r\n          <AvatarUpload\r\n            tinode={this.props.tinode}\r\n            avatar={this.state.imageUrl}\r\n            onImageUpdated={this.handleImageChanged}\r\n            onError={this.props.onError} />\r\n        </div>\r\n        <div  className=\"panel-form-row\">\r\n          <FormattedMessage id=\"full_name_prompt\" defaultMessage=\"Full name, e.g. John Doe\"\r\n            description=\"Input placeholder for person's full name\">{\r\n            (full_name_prompt) => <input type=\"text\" placeholder={full_name_prompt} autoComplete=\"name\"\r\n              value={this.state.fn} onChange={this.handleFnChange} required/>\r\n          }</FormattedMessage>\r\n        </div>\r\n        {this.props.reqCredMethod == 'email' ?\r\n          <div className=\"panel-form-row\">\r\n            <FormattedMessage id=\"email_prompt\" defaultMessage=\"Email, e.g. jdoe@example.com\"\r\n              description=\"Input placeholder for email entry\">{\r\n              (email_prompt) => <input type=\"email\" placeholder={email_prompt} autoComplete=\"email\"\r\n                value={this.state.email} onChange={this.handleEmailChange} required/>\r\n            }</FormattedMessage>\r\n          </div>\r\n          : this.props.reqCredMethod == 'tel' ?\r\n          <><div className=\"panel-form-row\">\r\n            <label className=\"small gray\"><FormattedMessage id=\"mobile_phone_number\" defaultMessage=\"Mobile phone number\"\r\n              description=\"Prompt for entering a mobile phone number\" /></label>\r\n          </div>\r\n          <div className=\"panel-form-row\">\r\n            <PhoneEdit\r\n              autoFocus={false}\r\n              onShowCountrySelector={this.props.onShowCountrySelector}\r\n              onSubmit={this.handlePhoneChange} />\r\n          </div></>\r\n          : null\r\n        }\r\n        <div className=\"panel-form-row\">\r\n          <CheckBox id=\"save-token\" name=\"save-token\" checked={this.state.saveToken}\r\n            onChange={this.handleToggleSaveToken} />\r\n          <FormattedMessage id=\"stay_logged_in\" defaultMessage=\"Stay logged in\"\r\n            description=\"Label for a checkbox\">{\r\n            (stay_logged_in) => <label htmlFor=\"save-token\">&nbsp;{stay_logged_in}</label>\r\n          }</FormattedMessage>\r\n        </div>\r\n        <div className=\"dialog-buttons\">\r\n          <button className={submitClasses} type=\"submit\" disabled={this.state.buttonDisabled}>\r\n            <FormattedMessage id=\"button_sign_up\" defaultMessage=\"Sign up\"\r\n              description=\"Create account button [Sign Up]\" />\r\n          </button>\r\n        </div>\r\n      </form>\r\n    );\r\n  }\r\n};\r\n","// Editor for a phone number.\r\n\r\nimport React from 'react';\r\nimport { defineMessages, injectIntl } from 'react-intl';\r\nimport { AsYouType, getExampleNumber, parsePhoneNumber } from 'libphonenumber-js/mobile';\r\nimport examples from 'libphonenumber-js/mobile/examples'\r\n\r\nimport * as dcodes from '../dcodes.json';\r\nimport { flagEmoji } from '../lib/strformat';\r\n\r\nconst messages = defineMessages({\r\n  mobile_number_required: {\r\n    id: 'mobile_number_required',\r\n    defaultMessage: 'Mobile phone number required',\r\n    description: 'Error message'\r\n  }\r\n});\r\n\r\nclass PhoneEdit extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.codeMap = {};\r\n    dcodes.default.forEach(dc => { this.codeMap[dc.code] = dc.dial; });\r\n\r\n    const code = props.countryCode || 'US';\r\n    const dial = this.codeMap[code];\r\n\r\n    this.state = {\r\n      countryCode: code,\r\n      dialCode: dial,\r\n      localNumber: '',\r\n      placeholderNumber: this.placeholderNumber(code, dial)\r\n    };\r\n\r\n    this.handleChange = this.handleChange.bind(this);\r\n    this.handleFinished = this.handleFinished.bind(this);\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n    this.showCountrySelector = this.showCountrySelector.bind(this);\r\n  }\r\n\r\n  handleChange(e) {\r\n    const prefix = `+${this.state.dialCode}`;\r\n    let formatted = new AsYouType().input(`${prefix}${this.filterNumber(e.target.value)}`);\r\n    formatted = formatted.substring(prefix.length).trim();\r\n    this.setState({localNumber: formatted});\r\n  }\r\n\r\n  handleFinished(e) {\r\n    e.preventDefault();\r\n    const raw = `${this.state.dialCode}${this.state.localNumber.trim()}`.replace(/[^\\d]/g, '');\r\n    let number = null;\r\n    try {\r\n      number = parsePhoneNumber(`+${raw}`);\r\n    } catch (err) {}\r\n\r\n    if (!number || !number.isValid()) {\r\n      this.inputField.setCustomValidity(this.props.intl.formatMessage(messages.mobile_number_required));\r\n      return;\r\n    }\r\n\r\n    this.inputField.setCustomValidity('');\r\n    this.props.onSubmit(number.format('E.164'));\r\n  }\r\n\r\n\r\n  handleKeyDown(e) {\r\n    if (e.key === 'Enter') {\r\n      this.handleFinished(e);\r\n    }\r\n  }\r\n\r\n  showCountrySelector() {\r\n    this.props.onShowCountrySelector(this.state.countryCode, this.state.dialCode,\r\n      (code, dial) => {\r\n          this.setState({\r\n            countryCode: code,\r\n            dialCode: dial,\r\n            placeholderNumber: this.placeholderNumber(code, dial)\r\n        })\r\n      });\r\n  }\r\n\r\n  // Filter out characters not permitted in a phone number.\r\n  filterNumber(number) {\r\n    if (!number) {\r\n      return number;\r\n    }\r\n    // Leave numbers, space, (, ), -, and .\r\n    // The + is not allowed: it's handled by the country code portion.\r\n    return number.replace(/[^-\\s().\\d]/g, '');\r\n  }\r\n\r\n  placeholderNumber(code, dial) {\r\n    const sample = getExampleNumber(code, examples);\r\n    return sample ? sample.formatInternational().substring(dial.length + 1).trim() : '123 0123';\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <span className=\"dial-code\" onClick={this.showCountrySelector}>\r\n          <span className=\"country-flag\">{flagEmoji(this.state.countryCode)}&nbsp;</span>\r\n          +{this.state.dialCode}&nbsp;</span>\r\n        <input type=\"tel\" ref={ref => {this.inputField = ref}} placeholder={this.state.placeholderNumber}\r\n            value={this.state.localNumber} onChange={this.handleChange}\r\n            maxLength={17} onKeyDown={this.handleKeyDown} onBlur={this.handleFinished}\r\n            required autoFocus={this.props.autoFocus} />\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default injectIntl(PhoneEdit);\r\n"],"names":["CreateAccountView","React","constructor","props","super","this","state","login","password","meth","email","tel","fn","imageUrl","uploadUrl","newAvatar","newAvatarMime","buttonDisabled","saveToken","LocalStorageUtil","getObject","handleLoginChange","bind","handlePasswordChange","handleEmailChange","handlePhoneChange","handleFnChange","handleImageChanged","handleToggleSaveToken","handleAvatarCropped","handleAvatarCropCancel","uploadAvatar","handleSubmit","tinode","connect","catch","err","onError","message","e","setState","target","value","number","mime","img","setObject","preventDefault","onCreateAccount","trim","theCard","substring","MAX_TITLE_LENGTH","blob","width","height","url","URL","createObjectURL","avatar","readyToUpload","image","size","MAX_AVATAR_BYTES","getLargeFileHelper","upload","then","finally","_","blobToBase64","b64","makeImageUrl","data","bits","type","AVATAR_SIZE","imageScaled","MAX_EXTERN_ATTACHMENT_SIZE","scaled","render","AvatarCrop","onSubmit","onCancel","submitClasses","disabled","className","FormattedMessage","id","defaultMessage","login_prompt","placeholder","autoComplete","onChange","required","autoFocus","password_prompt","VisiblePassword","onFinished","AvatarUpload","onImageUpdated","full_name_prompt","reqCredMethod","email_prompt","PhoneEdit","onShowCountrySelector","CheckBox","name","checked","stay_logged_in","htmlFor","messages","defineMessages","mobile_number_required","codeMap","dcodes","forEach","dc","code","dial","countryCode","dialCode","localNumber","placeholderNumber","handleChange","handleFinished","handleKeyDown","showCountrySelector","prefix","formatted","AsYouType","input","filterNumber","length","raw","replace","parsePhoneNumber","isValid","inputField","setCustomValidity","format","intl","formatMessage","key","sample","getExampleNumber","examples","formatInternational","onClick","flagEmoji","ref","maxLength","onKeyDown","onBlur","injectIntl"],"sourceRoot":""}